## 数据持久化

默认都是在程序运行的相对路径上

```cpp
//文件操作类
class FileUtils{
    //获取单例对象
	static FileUtils* getInstance();
    
    //判断文件是否存在
    bool isFileExist(string path);

    //查看完整路径
    string fullPathForFilename(string text);
    
    //获取可以写入的目录
    string getWritablePath();
    
    //设置搜索路径
    void setSearchPaths(vector<string>& searchPath);
    
    //添加搜索路径
    void addSearchPaths(vector<string>& searchPath);
    
    //获取所有搜索路径
    vector<string>& getSearchPaths();
}
```



## 读取文件的类

`UserDefault` 可以实现数据库储存,读取XML文档

使用范围:

1. 保存游戏设置
2. 长期的游戏对象
3. 没有SQL语句灵活,不宜使用它保留大量数据

```cpp
class UserDefault {
    
    static UserDefault* getInstance();
    
    //取出bool值
	bool getBoolForKey(const char* key);
    //键值不存在,返回默认值,其他函数都有类似的默认值函数
    bool getBoolForKey(const char* key,bool defaultValue);
    
    //取出int值
	int getIntegerForKey(const char* key);
    
    //取出float值
	float getFloatForKey(const char* key);
    
    //取出double值
	double getDoubleForKey(const char* key);
	
	//取出string值
	string getStringForKey(const char* key);
    
    //取出Data值
	Data getDataForKey(const char* key);
}
```

例:

```xml
<?xml version="1.0" encoding = "utf-8"?>

<Root>
	<key>root</key>
    <bool>true</bool>
</Root>
```

写入数据如下

```cpp
class UserDefault {
    
    static UserDefault* getInstance();
    
    //写入bool值
	bool setBoolForKey(const char* key,bool value);
    
    //写入double值
	double setDoubleForKey(const char* key,double value);
	
	//写入string值
	string setStringForKey(const char* key,string value);
    
    //写入Data值
	Data setDataForKey(const char* key,Data value);
};

```

# 文件读写

## 写入文件

```cpp
 //获取一个可写的文件路径
string fu = FileUtils::getInstance()->getWritablePath();

//获取一个

//通过相对路径建立一个文件路径
std::string path = FileUtils::getInstance()->getWritablePath() + "1.txt";

//w: 写入文件
FileUtils::getInstance()->writeStringToFile(str, path);

//获取文件中的内容，文本文件
auto data_str = FileUtils::getInstance()->getStringFromFile("data/a1.json");
```

## 文件的序列化

[json](www.json.org/)

cocos2d-x提供了JSON的头文件

```cpp
#include "spine/json.h"
```

使用json函数

```cpp
//创建json对象
//text json代码
Json* Json_create(const char* text);

//获取属性
Json* Json_getItem(Json *json,const char* id);

//SON的属性
struct Json{
    int size;   		//child 子孩子的数量
    int valueInt;		//返回一个int类型
    float valueFloat; 	//
    const char* valueString;
};
```

使用JSON进行文件序列化

```cpp
//读取文件中的所有字符串
std::string str=FileUtils::getinstance()->getStringFromFile("json/1.json");
//创建
Json *js=Json_create(str.data());
//子节点对象
Json *node=js->child;

//循环遍历节点
while(node){
    
    node=node->next;
}
```





