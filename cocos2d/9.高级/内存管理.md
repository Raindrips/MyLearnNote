# 内存管理

从源码的角度分析

### 引用计数

+ 内擦被引用一次,及增加一个计数,删除一个引用减少一个计数,计数为0,则进行垃圾回收,

  缺点,无法解决循环引用的问题.

### 标记-清除

1. 引用根节点开始标记的所有被引用的对象
2. 遍历整个堆,把未标记的对象清除

 ### 增量收集

实施垃圾回收算法

### 分代

对对象声明周期分析后得出垃圾回收算法,把对象分为青年代,年老代,持久代.现在的垃圾回收器使用的都是此算法



## cocos2d垃圾回收机制

1. 引用计数
2. 使用此对象,引用数+1
3. 不使用此对象,引用数-1

### 使用

+ 需要使用的时候`retian`
+ 不需要的时候`release`
+ 如果让系统自动调用的话可以使用`autorelease`
+ 使用`getCount`获取数据大小

## C++ 内存管理机制

+ 静态存储区

+ 常量区

+ 堆区

+ 栈区

  

# 内存管理

## 课程目标

- Cocos2d-x 课程管理机制
- 引用计数管理内存机制
- 自动释放机制

Cocos2d-x中的内存管理

```cpp
class Node{
    //阻止自动释放,之后需要手动用release释放
	void retain();
    
    //手动解除引用
	void release();
    
    //引用为0自动释放内存
	void autorelease();
    
    //返回被引用的次数
    int retainCount();
}
```

## 自动释放池

`CCPoolManager`

所有对象都使用了静态工厂模式,会自动自动释放数据

## cocos2d-x提供的宏

```c++
//释放内存
#define CC_SAFE_DELETE();


```









